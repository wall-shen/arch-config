require.scopes.prefs=function(){function t(t){var e=null;n.__defineGetter__(t,function(){if(null===e){if(t in localStorage)try{e=JSON.parse(localStorage[t])}catch(r){Cu.reportError(r)}null===e&&(e=JSON.parse(JSON.stringify(i[t])))}return e}),n.__defineSetter__(t,function(n){if(typeof n!=typeof i[t])throw new Error("Attempt to change preference type");var s=JSON.stringify(n);s!=JSON.stringify(i[t])?localStorage[t]=s:delete localStorage[t],e=n;for(var o=0;o<r.length;++o){var a=r[o];a(t)}return e})}var e={},i={__proto__:null,enabled:!0,data_directory:"",patternsbackups:5,patternsbackupinterval:24,savestats:!1,privateBrowsing:!1,subscriptions_fallbackerrors:5,subscriptions_fallbackurl:"https://adblockplus.org/getSubscription?version=%VERSION%&url=%SUBSCRIPTION%&downloadURL=%URL%&error=%ERROR%&channelStatus=%CHANNELSTATUS%&responseStatus=%RESPONSESTATUS%",subscriptions_autoupdate:!0,subscriptions_videoblockurl:"http://sub.adtchrome.com/adt-videolist.txt",documentation_link:"https://adblockplus.org/redirect?link=%LINK%&lang=%LANG%",notificationdata:{},notificationurl:"http://sub.adtchrome.com/updateSubscription.json",guidePageData:{},guidePageUrl:"http://sub.adtchrome.com/guidePage.json",stats_total:{}},r=[],n=e.Prefs={addListener:function(t){r.indexOf(t)<0&&r.push(t)},removeListener:function(t){var e=r.indexOf(t);e>=0&&r.splice(e,1)}};for(var s in i)t(s);return e}(),require.scopes.utils=function(){var t,e={},i=e.Utils={systemPrincipal:null,getString:function(t){return t},runAsync:function(e){if(e=e.bind.apply(e,Array.prototype.slice.call(arguments,1)),"undefined"==typeof t&&(t="loading"==document.readyState?[]:null)){var i=function(){document.removeEventListener("DOMContentLoaded",i,!1);var e=t;t=null;for(var r=0;r<e.length;++r){var n=e[r];try{n()}catch(s){Cu.reportError(s)}}};document.addEventListener("DOMContentLoaded",i,!1)}t?t.push(e):window.setTimeout(e,0)},get appLocale(){var t=chrome.i18n.getMessage("@@ui_locale").replace(/_/g,"-");return this.__defineGetter__("appLocale",function(){return t}),this.appLocale},generateChecksum:function(t){return null},makeURI:function(t){return Services.io.newURI(t)},getDocLink:function(t){var e=require("prefs").Prefs,r=e.documentation_link;return r.replace(/%LINK%/g,t).replace(/%LANG%/g,i.appLocale)}};return e}(),require.scopes.elemHideHitRegistration=function(){var t={};t.AboutHandler={};return t}(),require.scopes.downloader=function(){var t={},e=require("utils").Utils,i=t.MILLIS_IN_SECOND=1e3,r=t.MILLIS_IN_MINUTE=60*i,n=t.MILLIS_IN_HOUR=60*r,s=t.MILLIS_IN_DAY=24*n,o=t.Downloader=function(t,e,i){this.dataSource=t,this._timer=Cc["@mozilla.org/timer;1"].createInstance(Ci.nsITimer),this._timer.initWithCallback(function(){this._timer.delay=i,this._doCheck()}.bind(this),e,Ci.nsITimer.TYPE_REPEATING_SLACK),this._downloading=Object.create(null)};o.prototype={_timer:null,_downloading:null,dataSource:null,maxAbsenseInterval:1*s,minRetryInterval:1*s,maxExpirationInterval:14*s,maxRedirects:5,onExpirationChange:null,onDownloadStarted:null,onDownloadSuccess:null,onDownloadError:null,_doCheck:function(){for(var t=Date.now(),e=0;e<this.dataSource().length;++e){var i=this.dataSource()[e];i.lastCheck&&t-i.lastCheck>this.maxAbsenseInterval&&(i.softExpiration+=t-i.lastCheck),i.lastCheck=t,i.hardExpiration-t>this.maxExpirationInterval&&(i.hardExpiration=t+this.maxExpirationInterval),i.softExpiration-t>this.maxExpirationInterval&&(i.softExpiration=t+this.maxExpirationInterval),this.onExpirationChange&&this.onExpirationChange(i),i.softExpiration>t&&i.hardExpiration>t||i.lastError&&t-i.lastError<this.minRetryInterval||this._download(i,0)}},cancel:function(){this._timer.cancel()},isDownloading:function(t){return t in this._downloading},download:function(t){e.runAsync(this._download.bind(this,t,0))},getDownloadUrl:function(t){var e=require("info"),i=e.addonName,r=e.addonVersion,n=e.application,s=e.applicationVersion,o=e.platform,a=e.platformVersion,l=t.redirectURL||t.url;return l+=l.indexOf("?")>=0?"&":"?",l+="addonName="+encodeURIComponent(i)+"&addonVersion="+encodeURIComponent(r)+"&application="+encodeURIComponent(n)+"&applicationVersion="+encodeURIComponent(s)+"&platform="+encodeURIComponent(o)+"&platformVersion="+encodeURIComponent(a)+"&lastVersion="+encodeURIComponent(t.lastVersion)+"&t="+Date.now()},_download:function(t,e){if(!(t.url in this._downloading)){var i=this.getDownloadUrl(t),r=null,n=function(n){var s=-1;try{s=r.channel.status}catch(o){}var a=r.status;if(Cu.reportError("Adblock Plus: Downloading URL "+t.url+" failed ("+n+")\nDownload address: "+i+"\nChannel status: "+s+"\nServer response: "+a),this.onDownloadError){var l=null;e<=this.maxRedirects&&(l=function(i){t.redirectURL=i,this._download(t,e+1)}.bind(this)),this.onDownloadError(t,i,n,s,a,l)}}.bind(this);try{r=new XMLHttpRequest,r.mozBackgroundRequest=!0,r.open("GET",i)}catch(s){return void n("synchronize_invalid_url")}try{r.overrideMimeType("text/plain"),r.channel.loadFlags=r.channel.loadFlags|r.channel.INHIBIT_CACHING|r.channel.VALIDATE_ALWAYS,r.channel instanceof Ci.nsIHttpChannel&&(r.channel.redirectionLimit=this.maxRedirects)}catch(s){Cu.reportError(s)}r.addEventListener("error",function(e){onShutdown.done||(delete this._downloading[t.url],n("synchronize_connection_error"))}.bind(this),!1),r.addEventListener("load",function(i){if(!onShutdown.done)return delete this._downloading[t.url],r.status&&200!=r.status?void n("synchronize_connection_error"):void this.onDownloadSuccess(t,r.responseText,n,function(i){e>=this.maxRedirects?n("synchronize_connection_error"):(t.redirectURL=i,this._download(t,e+1))}.bind(this))}.bind(this),!1),this._downloading[t.url]=!0,this.onDownloadStarted&&this.onDownloadStarted(t),r.send(null)}},processExpirationInterval:function(t){t=Math.min(Math.max(t,0),this.maxExpirationInterval);var e=Math.round(t*(.4*Math.random()+.8)),i=2*t,r=Date.now();return[r+e,r+i]}};var a=t.Downloadable=function(t){this.url=t};return a.prototype={url:null,redirectURL:null,lastError:0,lastCheck:0,lastVersion:0,softExpiration:0,hardExpiration:0},t}(),require.scopes.filterNotifier=function(){var t={},e=[];t.FilterNotifier={addListener:function(t){e.indexOf(t)>=0||e.push(t)},removeListener:function(t){var i=e.indexOf(t);i>=0&&e.splice(i,1)},triggerListeners:function(t,i,r,n,s){for(var o=0;o<e.length;++o){var a=e[o];a(t,i,r,n,s)}}};return t}(),require.scopes.filterClasses=function(){function t(t){this.text=t,this.subscriptions=[]}function e(e,i){t.call(this,e),this.reason=i}function i(e){t.call(this,e)}function r(e,i){t.call(this,e),this.domainSource=i}function n(t,e,i,n,s,o){if(r.call(this,t,s),null!=i&&(this.contentType=i),n&&(this.matchCase=n),null!=o&&(this.thirdParty=o),e.length>=2&&"/"==e[0]&&"/"==e[e.length-1]){var a=new RegExp(e.substr(1,e.length-2),this.matchCase?"":"i");this.__defineGetter__("regexp",function(){return a})}else this.regexpSource=e}function s(t,e,i,r,s,o,a){n.call(this,t,e,i,r,s,o),this.collapse=a}function o(t,e,i,r,s,o,a,l,u){n.call(this,t,e,i,r,s,o),this.collapse=a,this.replace=l,this.keyword=u,this.redirect=function(t){var e=t.replace(this.regexp,l);return e}}function a(t,e,i,r,s,o,a){n.call(this,t,e,i,r,s,o),null!=a&&(this.siteKeys=a)}function l(t,e,i){r.call(this,t,e?e.toUpperCase():null),e&&(this.selectorDomain=e.replace(/,~[^,]+/g,"").replace(/^~[^,]+,?/,"").toLowerCase()),this.selector=i}function u(t,e,i){l.call(this,t,e,i)}function c(t,e,i){l.call(this,t,e,i)}var d={},p=require("filterNotifier").FilterNotifier;return d.Filter=t,t.prototype={text:null,subscriptions:null,serialize:function(t){t.push("[Filter]"),t.push("text="+this.text)},toString:function(){return this.text}},t.knownFilters={__proto__:null},t.elemhideRegExp=/^([^\/\*\|\@"!]*?)#(\@)?(?:([\w\-]+|\*)((?:\([\w\-]+(?:[$^*]?=[^\(\)"]*)?\))*)|#([^{}]+))$/,t.regexpRegExp=/^(@@)?\/.*\/(?:\$~?[\w\-]+(?:=[^,\s]+)?(?:,~?[\w\-]+(?:=[^,\s]+)?)*)?$/,t.optionsRegExp=/\$(~?[\w\-]+(?:=[^,\s]+)?(?:,~?[\w\-]+(?:=[^,\s]+)?)*)$/,t.fromText=function(e){if(e in t.knownFilters)return t.knownFilters[e];var r,s=e.indexOf("#")>=0?t.elemhideRegExp.exec(e):null;return r=s?l.fromText(e,s[1],s[2],s[3],s[4],s[5]):"!"==e[0]?new i(e):n.fromText(e),t.knownFilters[r.text]=r,r},t.fromObject=function(e){var i=t.fromText(e.text);return i instanceof r&&("disabled"in e&&(i._disabled="true"==e.disabled),"hitCount"in e&&(i._hitCount=parseInt(e.hitCount)||0),"lastHit"in e&&(i._lastHit=parseInt(e.lastHit)||0)),i},t.normalize=function(e){if(!e)return e;if(e=e.replace(/[^\S ]/g,""),/^\s*!/.test(e))return e.replace(/^\s+/,"").replace(/\s+$/,"");if(t.elemhideRegExp.test(e)){var i=/^(.*?)(#\@?#?)(.*)$/.exec(e),r=i[1],n=i[2],s=i[3];return r.replace(/\s/g,"")+n+s.replace(/^\s+/,"").replace(/\s+$/,"")}return e.replace(/\s/g,"")},d.InvalidFilter=e,e.prototype={__proto__:t.prototype,reason:null,serialize:function(t){}},d.CommentFilter=i,i.prototype={__proto__:t.prototype,serialize:function(t){}},d.ActiveFilter=r,r.prototype={__proto__:t.prototype,_disabled:!1,_hitCount:0,_lastHit:0,get disabled(){return this._disabled},set disabled(t){if(t!=this._disabled){var e=this._disabled;this._disabled=t,p.triggerListeners("filter.disabled",this,t,e)}return this._disabled},get hitCount(){return this._hitCount},set hitCount(t){if(t!=this._hitCount){var e=this._hitCount;this._hitCount=t,p.triggerListeners("filter.hitCount",this,t,e)}return this._hitCount},get lastHit(){return this._lastHit},set lastHit(t){if(t!=this._lastHit){var e=this._lastHit;this._lastHit=t,p.triggerListeners("filter.lastHit",this,t,e)}return this._lastHit},domainSource:null,domainSeparator:null,ignoreTrailingDot:!0,get domains(){var t=null;if(this.domainSource){var e=this.domainSource.split(this.domainSeparator);if(1==e.length&&"~"!=e[0][0])t={__proto__:null,"":!1},this.ignoreTrailingDot&&(e[0]=e[0].replace(/\.+$/,"")),t[e[0]]=!0;else{for(var i=!1,r=0;r<e.length;r++){var n=e[r];if(this.ignoreTrailingDot&&(n=n.replace(/\.+$/,"")),""!=n){var s;"~"==n[0]?(s=!1,n=n.substr(1)):(s=!0,i=!0),t||(t={__proto__:null}),t[n]=s}}t[""]=!i}delete this.domainSource}return this.__defineGetter__("domains",function(){return t}),this.domains},isActiveOnDomain:function(t){if(!this.domains)return!0;if(!t)return this.domains[""];for(this.ignoreTrailingDot&&(t=t.replace(/\.+$/,"")),t=t.toUpperCase();;){if(t in this.domains)return this.domains[t];var e=t.indexOf(".");if(e<0)break;t=t.substr(e+1)}return this.domains[""]},isActiveOnlyOnDomain:function(t){if(!t||!this.domains||this.domains[""])return!1;this.ignoreTrailingDot&&(t=t.replace(/\.+$/,"")),t=t.toUpperCase();for(var e in this.domains)if(this.domains[e]&&e!=t&&(e.length<=t.length||e.indexOf("."+t)!=e.length-t.length-1))return!1;return!0},serialize:function(e){(this._disabled||this._hitCount||this._lastHit)&&(t.prototype.serialize.call(this,e),this._disabled&&e.push("disabled=true"),this._hitCount&&e.push("hitCount="+this._hitCount),this._lastHit&&e.push("lastHit="+this._lastHit))}},d.RegExpFilter=n,n.prototype={__proto__:r.prototype,length:1,domainSeparator:"|",regexpSource:null,get regexp(){var t=this.regexpSource.replace(/\*+/g,"*");"*"==t[0]&&(t=t.substr(1));var e=t.length-1;e>=0&&"*"==t[e]&&(t=t.substr(0,e)),t=t.replace(/\^\|$/,"^").replace(/\W/g,"\\$&").replace(/\\\*/g,".*").replace(/\\\^/g,"(?:[\\x00-\\x24\\x26-\\x2C\\x2F\\x3A-\\x40\\x5B-\\x5E\\x60\\x7B-\\x80]|$)").replace(/^\\\|\\\|/,"^[\\w\\-]+:\\/+(?!\\/)(?:[^.\\/]+\\.)*?").replace(/^\\\|/,"^").replace(/\\\|$/,"$");var i=new RegExp(t,this.matchCase?"":"i");return delete this.regexpSource,this.__defineGetter__("regexp",function(){return i}),this.regexp},contentType:2147483647,matchCase:!1,thirdParty:null,matches:function(t,e,i,r){return!(!this.regexp.test(t)||0==(n.typeMap[e]&this.contentType)||null!=this.thirdParty&&this.thirdParty!=r||!this.isActiveOnDomain(i))}},n.prototype.__defineGetter__("0",function(){return this}),n.fromText=function(i){var r=!0,l=i;0==i.indexOf("@@")&&(r=!1,i=i.substr(2));var u,c=null,d=null,p=null,f=null,h=null,_=null,b=i.indexOf(">>>");if(b>=0){var v=l.substring(0,b),g=i.indexOf(">>>>"),w=l.substring(b+3,g),m=l.substring(g+4).split(","),S=m[0].split("=")[1];return new o(l,v,c,d,p,h,_,w,S)}var y=i.indexOf("$")>=0?t.optionsRegExp.exec(i):null;if(y){u=y[1].toUpperCase().split(","),i=y.input.substr(0,y.index);for(var x=0;x<u.length;++x){var E=u[x],C=null,k=E.indexOf("=");if(k>=0&&(C=E.substr(k+1),E=E.substr(0,k)),E=E.replace(/-/,"_"),E in n.typeMap)null==c&&(c=0),c|=n.typeMap[E];else if("~"==E[0]&&E.substr(1)in n.typeMap)null==c&&(c=n.prototype.contentType),c&=~n.typeMap[E.substr(1)];else if("MATCH_CASE"==E)d=!0;else if("~MATCH_CASE"==E)d=!1;else if("DOMAIN"==E&&"undefined"!=typeof C)p=C;else if("THIRD_PARTY"==E)h=!0;else if("~THIRD_PARTY"==E)h=!1;else if("COLLAPSE"==E)_=!0;else if("~COLLAPSE"==E)_=!1;else{if("SITEKEY"!=E||"undefined"==typeof C)return new e(l,"Unknown option "+E.toLowerCase());f=C.split(/\|/)}}}r||!(null==c||c&n.typeMap.DOCUMENT)||u&&!(u.indexOf("DOCUMENT")<0)||/^\|?[\w\-]+:/.test(i)||(null==c&&(c=n.prototype.contentType),c&=~n.typeMap.DOCUMENT),!r&&f&&(c=n.typeMap.DOCUMENT);try{return r?new s(l,i,c,d,p,h,_):new a(l,i,c,d,p,h,f)}catch(I){return new e(l,I)}},n.typeMap={OTHER:1,SCRIPT:2,IMAGE:4,STYLESHEET:8,OBJECT:16,SUBDOCUMENT:32,DOCUMENT:64,XBL:1,PING:1,XMLHTTPREQUEST:2048,OBJECT_SUBREQUEST:4096,DTD:1,MEDIA:16384,FONT:32768,BACKGROUND:4,POPUP:268435456,ELEMHIDE:1073741824},n.prototype.contentType&=~(n.typeMap.ELEMHIDE|n.typeMap.POPUP),d.BlockingFilter=s,s.prototype={__proto__:n.prototype,collapse:null},d.RedirectFilter=o,o.prototype={__proto__:n.prototype,collapse:null,replace:null},d.WhitelistFilter=a,a.prototype={__proto__:n.prototype,siteKeys:null},d.ElemHideBase=l,l.prototype={__proto__:r.prototype,domainSeparator:",",ignoreTrailingDot:!1,selectorDomain:null,selector:null},l.fromText=function(t,i,r,n,s,o){if(!o){"*"==n&&(n="");var a=null,l="";if(s){s=s.match(/\([\w\-]+(?:[$^*]?=[^\(\)"]*)?\)/g);for(var d=0;d<s.length;++d){var p=s[d];p=p.substr(1,p.length-2);var f=p.indexOf("=");if(f>0)p=p.replace(/=/,'="')+'"',l+="["+p+"]";else{if(a){var h=require("utils").Utils;return new e(t,h.getString("filter_elemhide_duplicate_id"))}a=p}}}if(a)o=n+"."+a+l+","+n+"#"+a+l;else{if(!n&&!l){var h=require("utils").Utils;return new e(t,h.getString("filter_elemhide_nocriteria"))}o=n+l}}return r?new c(t,i,o):new u(t,i,o)},d.ElemHideFilter=u,u.prototype={__proto__:l.prototype},d.ElemHideException=c,c.prototype={__proto__:l.prototype},d}(),require.scopes.subscriptionClasses=function(){function t(e,i){if(this.url=e,this.filters=[],i)this._title=i;else{var r=require("utils").Utils;this._title=r.getString("newGroup_title")}t.knownSubscriptions[e]=this}function e(e,i){t.call(this,e,i)}function i(e,i){t.call(this,e,i||e)}function r(t,e){i.call(this,t,e)}function n(t,e){i.call(this,t,e)}var s={},o=require("filterClasses"),a=o.ActiveFilter,l=o.BlockingFilter,u=o.WhitelistFilter,c=o.ElemHideBase,d=require("filterNotifier").FilterNotifier;return s.Subscription=t,t.prototype={url:null,filters:null,_title:null,_fixedTitle:!1,_disabled:!1,get title(){return this._title},set title(t){if(t!=this._title){var e=this._title;this._title=t,d.triggerListeners("subscription.title",this,t,e)}return this._title},get fixedTitle(){return this._fixedTitle},set fixedTitle(t){if(t!=this._fixedTitle){var e=this._fixedTitle;this._fixedTitle=t,d.triggerListeners("subscription.fixedTitle",this,t,e)}return this._fixedTitle},get disabled(){return this._disabled},set disabled(t){if(t!=this._disabled){var e=this._disabled;this._disabled=t,d.triggerListeners("subscription.disabled",this,t,e)}return this._disabled},serialize:function(t){t.push("[Subscription]"),t.push("url="+this.url),t.push("title="+this._title),this._fixedTitle&&t.push("fixedTitle=true"),this._disabled&&t.push("disabled=true")},serializeFilters:function(t){for(var e=0;e<this.filters.length;++e){var i=this.filters[e];t.push(i.text.replace(/\[/g,"\\["))}},toString:function(){var t=[];return this.serialize(t),t.join("\n")}},t.knownSubscriptions={__proto__:null},t.fromURL=function(i){if(i in t.knownSubscriptions)return t.knownSubscriptions[i];try{return i=Services.io.newURI(i,null,null).spec,new n(i,null)}catch(r){return new e(i)}},t.fromObject=function(t){var i;try{if(t.url=Services.io.newURI(t.url,null,null).spec,i=new n(t.url,t.title),"downloadStatus"in t&&(i._downloadStatus=t.downloadStatus),"lastSuccess"in t&&(i.lastSuccess=parseInt(t.lastSuccess)||0),"lastCheck"in t&&(i._lastCheck=parseInt(t.lastCheck)||0),"expires"in t&&(i.expires=parseInt(t.expires)||0),"softExpiration"in t&&(i.softExpiration=parseInt(t.softExpiration)||0),"errors"in t&&(i._errors=parseInt(t.errors)||0),"version"in t&&(i.version=parseInt(t.version)||0),"requiredVersion"in t){var r=require("info").addonVersion;i.requiredVersion=t.requiredVersion,Services.vc.compare(i.requiredVersion,r)>0&&(i.upgradeRequired=!0)}"homepage"in t&&(i._homepage=t.homepage),"lastDownload"in t&&(i._lastDownload=parseInt(t.lastDownload)||0)}catch(s){if(!("title"in t)&&("~wl~"==t.url?t.defaults="whitelist":"~fl~"==t.url?t.defaults="blocking":"~eh~"==t.url&&(t.defaults="elemhide"),"defaults"in t)){var o=require("utils").Utils;t.title=o.getString(t.defaults+"Group_title")}i=new e(t.url,t.title),"defaults"in t&&(i.defaults=t.defaults.split(" "))}return"fixedTitle"in t&&(i._fixedTitle="true"==t.fixedTitle),"disabled"in t&&(i._disabled="true"==t.disabled),i},s.SpecialSubscription=e,e.prototype={__proto__:t.prototype,defaults:null,isDefaultFor:function(t){if(this.defaults&&this.defaults.length)for(var i=0;i<this.defaults.length;++i){var r=this.defaults[i];if(t instanceof e.defaultsMap[r])return!0;if(!(t instanceof a)&&"blacklist"==r)return!0}return!1},serialize:function(i){t.prototype.serialize.call(this,i),this.defaults&&this.defaults.length&&i.push("defaults="+this.defaults.filter(function(t){return t in e.defaultsMap}).join(" ")),this._lastDownload&&i.push("lastDownload="+this._lastDownload)}},e.defaultsMap={__proto__:null,whitelist:u,blocking:l,elemhide:c},e.create=function(i){var r;do r="~user~"+Math.round(1e6*Math.random());while(r in t.knownSubscriptions);return new e(r,i)},e.createForFilter=function(t){var i=e.create();i.filters.push(t);for(var r in e.defaultsMap)t instanceof e.defaultsMap[r]&&(i.defaults=[r]);i.defaults||(i.defaults=["blocking"]);var n=require("utils").Utils;return i.title=n.getString(i.defaults[0]+"Group_title"),i},s.RegularSubscription=i,i.prototype={__proto__:t.prototype,_homepage:null,_lastDownload:0,get homepage(){return this._homepage},set homepage(t){if(t!=this._homepage){var e=this._homepage;this._homepage=t,d.triggerListeners("subscription.homepage",this,t,e)}return this._homepage},get lastDownload(){return this._lastDownload},set lastDownload(t){if(t!=this._lastDownload){var e=this._lastDownload;this._lastDownload=t,d.triggerListeners("subscription.lastDownload",this,t,e)}return this._lastDownload},serialize:function(e){t.prototype.serialize.call(this,e),this._homepage&&e.push("homepage="+this._homepage),this._lastDownload&&e.push("lastDownload="+this._lastDownload)}},s.ExternalSubscription=r,r.prototype={__proto__:i.prototype,serialize:function(t){throw new Error("Unexpected call, external subscriptions should not be serialized")}},s.DownloadableSubscription=n,n.prototype={__proto__:i.prototype,_downloadStatus:null,_lastCheck:0,_errors:0,get downloadStatus(){return this._downloadStatus},set downloadStatus(t){var e=this._downloadStatus;return this._downloadStatus=t,d.triggerListeners("subscription.downloadStatus",this,t,e),this._downloadStatus},lastSuccess:0,get lastCheck(){return this._lastCheck},set lastCheck(t){if(t!=this._lastCheck){var e=this._lastCheck;this._lastCheck=t,d.triggerListeners("subscription.lastCheck",this,t,e)}return this._lastCheck},expires:0,softExpiration:0,get errors(){return this._errors},set errors(t){if(t!=this._errors){var e=this._errors;this._errors=t,d.triggerListeners("subscription.errors",this,t,e)}return this._errors},version:0,requiredVersion:null,upgradeRequired:!1,serialize:function(t){i.prototype.serialize.call(this,t),this.downloadStatus&&t.push("downloadStatus="+this.downloadStatus),this.lastSuccess&&t.push("lastSuccess="+this.lastSuccess),this.lastCheck&&t.push("lastCheck="+this.lastCheck),this.expires&&t.push("expires="+this.expires),this.softExpiration&&t.push("softExpiration="+this.softExpiration),this.errors&&t.push("errors="+this.errors),this.version&&t.push("version="+this.version),this.requiredVersion&&t.push("requiredVersion="+this.requiredVersion)}},s}(),require.scopes.filterStorage=function(){function t(t){if(t.url in _.knownSubscriptions)for(var e=0;e<t.filters.length;++e){var i=t.filters[e];i.subscriptions.push(t)}}function e(t){if(t.url in _.knownSubscriptions)for(var e=0;e<t.filters.length;++e){var i=t.filters[e],r=i.subscriptions.indexOf(t);r>=0&&i.subscriptions.splice(r,1)}}function i(){this.fileProperties=this.curObj={},this.subscriptions=[],this.knownFilters={__proto__:null},this.knownSubscriptions={__proto__:null}}var r={},n=require("io").IO,s=require("prefs").Prefs,o=require("filterClasses"),a=o.Filter,l=o.ActiveFilter,u=require("subscriptionClasses"),c=u.Subscription,d=u.SpecialSubscription,p=u.ExternalSubscription,f=require("filterNotifier").FilterNotifier,h=4,_=r.FilterStorage={get formatVersion(){return h},get sourceFile(){var t=null;if(s.patternsfile&&(t=n.resolveFilePath(s.patternsfile)),t||(t=n.resolveFilePath(s.data_directory),t&&t.append("patterns.ini")),!t)try{t=n.resolveFilePath(Services.prefs.getDefaultBranch("extensions.adblockplus.").getCharPref("data_directory")),t&&t.append("patterns.ini")}catch(e){}return t||Cu.reportError("Adblock Plus: Failed to resolve filter file location from extensions.adblockplus.patternsfile preference"),this.__defineGetter__("sourceFile",function(){return t}),this.sourceFile},fileProperties:{__proto__:null},subscriptions:[],knownSubscriptions:{__proto__:null},getGroupForFilter:function(t){for(var e=null,i=0;i<_.subscriptions.length;++i){var r=_.subscriptions[i];if(r instanceof d&&!r.disabled){if(r.isDefaultFor(t))return r;e||r.defaults&&r.defaults.length||(e=r)}}return e},addSubscription:function(e,i){e.url in _.knownSubscriptions||(_.subscriptions.push(e),_.knownSubscriptions[e.url]=e,t(e),i||f.triggerListeners("subscription.added",e))},removeSubscription:function(t,i){for(var r=0;r<_.subscriptions.length;r++)if(_.subscriptions[r].url==t.url)return e(t),_.subscriptions.splice(r--,1),delete _.knownSubscriptions[t.url],void(i||f.triggerListeners("subscription.removed",t))},moveSubscription:function(t,e){var i=_.subscriptions.indexOf(t);if(!(i<0)){var r=e?_.subscriptions.indexOf(e):-1;r<0&&(r=_.subscriptions.length),i<r&&r--,i!=r&&(_.subscriptions.splice(i,1),_.subscriptions.splice(r,0,t),f.triggerListeners("subscription.moved",t))}},updateSubscriptionFilters:function(i,r){e(i),i.oldFilters=i.filters,i.filters=r,t(i),f.triggerListeners("subscription.updated",i),delete i.oldFilters},addFilter:function(t,e,i,r){if(!e){if(t.subscriptions.some(function(t){return t instanceof d&&!t.disabled}))return;e=_.getGroupForFilter(t)}return e?("undefined"==typeof i&&(i=e.filters.length),t.subscriptions.indexOf(e)<0&&t.subscriptions.push(e),e.filters.splice(i,0,t),void(r||f.triggerListeners("filter.added",t,e,i))):(e=d.createForFilter(t),void this.addSubscription(e))},removeFilter:function(t,e,i){for(var r=e?[e]:t.subscriptions.slice(),n=0;n<r.length;n++){var e=r[n];if(e instanceof d){var s=[];if("undefined"==typeof i){var o=-1;do o=e.filters.indexOf(t,o+1),o>=0&&s.push(o);while(o>=0)}else s.push(i);for(var a=s.length-1;a>=0;a--){var i=s[a];if(e.filters[i]==t){if(e.filters.splice(i,1),e.filters.indexOf(t)<0){var o=t.subscriptions.indexOf(e);o>=0&&t.subscriptions.splice(o,1)}f.triggerListeners("filter.removed",t,e,i)}}}}},moveFilter:function(t,e,i,r){e instanceof d&&e.filters[i]==t&&(r=Math.min(Math.max(r,0),e.filters.length-1),i!=r&&(e.filters.splice(i,1),e.filters.splice(r,0,t),f.triggerListeners("filter.moved",t,e,i,r)))},increaseHitCount:function(t,e){s.savestats&&!b.enabledForWindow(e)&&!b.enabled&&t instanceof l&&(t.hitCount++,t.lastHit=Date.now())},resetHitCounts:function(t){if(!t){t=[];for(var e in a.knownFilters)t.push(a.knownFilters[e])}for(var i=0;i<t.length;++i){var r=t[i];r.hitCount=0,r.lastHit=0}},_loading:!1,loadFromDisk:function(t){if(!this._loading){var e,r=function(t,o){var a=new i;n.readFromFile(t,!0,a,function(i){if(i||0!=a.subscriptions.length||(i=new Error("No data in the file")),i&&Cu.reportError(i),i&&!e&&(t=this.sourceFile)){var l=/^(.*)(\.\w+)$/.exec(t.leafName)||[null,t.leafName,""],u=l[1],c=l[2];return t=t.clone(),t.leafName=u+"-backup"+ ++o+c,void n.statFile(t,function(e,i){!e&&i.exists?r(t,o):s(a)})}s(a)}.bind(this),"FilterStorageRead")}.bind(this),s=function(e){for(var i={"~il~":!0,"~wl~":!0,"~fl~":!0,"~eh~":!0},r={__proto__:null},n=0;n<e.subscriptions.length;n++){var s=e.subscriptions[n];s instanceof d&&0==s.filters.length&&s.url in i?e.subscriptions.splice(n--,1):r[s.url]=s}if(this.fileProperties=e.fileProperties,this.subscriptions=e.subscriptions,this.knownSubscriptions=r,a.knownFilters=e.knownFilters,c.knownSubscriptions=e.knownSubscriptions,e.userFilters)for(var n=0;n<e.userFilters.length;n++){var o=a.fromText(e.userFilters[n]);this.addFilter(o,null,void 0,!0)}this._loading=!1,f.triggerListeners("load"),t!=this.sourceFile&&this.saveToDisk()}.bind(this),o=function(t){this._loading=!0,r(t,0)}.bind(this);if(t)e=!0,o(t);else{e=!1,t=_.sourceFile;var l=function(e,i){if(e||!i.exists){var r=require("info").addonRoot;t=Services.io.newURI(r+"defaults/patterns.ini",null,null)}o(t)};t?n.statFile(t,l):l(!0)}}},_generateFilterData:function(t){var e=[];e.push("# Adblock Plus preferences"),e.push("version="+h);for(var i={__proto__:null},r=[],n=0;n<t.length;n++)for(var s=t[n],o=0;o<s.filters.length;o++){var a=s.filters[o];if(!(a.text in i)){a.serialize(r),i[a.text]=a;for(var l=0;l<r.length;l++)e.push(r[l]);r.splice(0)}}for(var n=0;n<t.length;n++){var s=t[n];e.push(""),s.serialize(r),s.filters.length&&(r.push("","[Subscription filters]"),s.serializeFilters(r));for(var l=0;l<r.length;l++)e.push(r[l]);r.splice(0)}return e},_saving:!1,_needsSave:!1,saveToDisk:function(t){var e=!0;if(t||(t=_.sourceFile,e=!1),t){if(!e&&this._saving)return void(this._needsSave=!0);try{t.parent.create(Ci.nsIFile.DIRECTORY_TYPE,FileUtils.PERMS_DIRECTORY)}catch(i){}var r=function(){n.writeToFile(t,!0,this._generateFilterData(u),function(t){e||(this._saving=!1),t&&Cu.reportError(t),!e&&this._needsSave?(this._needsSave=!1,this.saveToDisk()):f.triggerListeners("save")}.bind(this),"FilterStorageWrite")}.bind(this),o=function(i,r){e||s.patternsbackups<=0?i():n.statFile(t,function(e,o){if(e||!o.exists)i();else{var a=/^(.*)(\.\w+)$/.exec(t.leafName)||[null,t.leafName,""],l=a[1],u=a[2],c=t.clone();c.leafName=l+"-backup1"+u,n.statFile(c,function(t,e){t||e.exists&&!((Date.now()-e.lastModified)/36e5>=s.patternsbackupinterval)?i():r(l,u)})}})}.bind(this),a=function(e,i){var r=t.clone();r.leafName=e+"-backup"+s.patternsbackups+i,n.removeFile(r,function(t){return l(e,i,s.patternsbackups-1)})}.bind(this),l=function(e,i,s){if(s>0){var o=t.clone();o.leafName=e+"-backup"+s+i;var a=e+"-backup"+(s+1)+i;n.renameFile(o,a,function(t){return l(e,i,s-1)})}else{var u=t.clone();u.leafName=e+"-backup"+(s+1)+i,n.copyFile(t,u,r)}}.bind(this),u=this.subscriptions.filter(function(t){return!(t instanceof p)});e||(this._saving=!0),o(r,a)}},getBackupFiles:function(){for(var t=[],e=/^(.*)(\.\w+)$/.exec(_.sourceFile.leafName)||[null,_.sourceFile.leafName,""],i=e[1],r=e[2],n=1;;n++){var s=_.sourceFile.clone();if(s.leafName=i+"-backup"+n+r,!s.exists())break;t.push(s)}return t}},b=r.PrivateBrowsing={enabled:!1,enabledForWindow:function(t){try{return t.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsILoadContext).usePrivateBrowsing}catch(e){return e.result!=Cr.NS_NOINTERFACE&&Cu.reportError(e),!1}},init:function(){if("@mozilla.org/privatebrowsing;1"in Cc)try{this.enabled=Cc["@mozilla.org/privatebrowsing;1"].getService(Ci.nsIPrivateBrowsingService).privateBrowsingEnabled,Services.obs.addObserver(this,"private-browsing",!0),onShutdown.add(function(){Services.obs.removeObserver(this,"private-browsing")}.bind(this))}catch(t){Cu.reportError(t)}},observe:function(t,e,i){"private-browsing"==e&&("enter"==i?this.enabled=!0:"exit"==i&&(this.enabled=!1))},QueryInterface:XPCOMUtils.generateQI([Ci.nsISupportsWeakReference,Ci.nsIObserver])};return b.init(),i.prototype={subscriptions:null,knownFilters:null,knownSubscrptions:null,wantObj:!0,fileProperties:null,curObj:null,curSection:null,userFilters:null,process:function(t){var e=a.knownFilters;a.knownFilters=this.knownFilters;var i=c.knownSubscriptions;c.knownSubscriptions=this.knownSubscriptions;var r;try{if(this.wantObj===!0&&(r=/^(\w+)=(.*)$/.exec(t)))this.curObj[r[1]]=r[2];else if(null===t||(r=/^\s*\[(.+)\]\s*$/.exec(t))){if(this.curObj)switch(this.curSection){case"filter":case"pattern":"text"in this.curObj&&a.fromObject(this.curObj);break;case"subscription":var n=c.fromObject(this.curObj);n&&this.subscriptions.push(n);break;case"subscription filters":case"subscription patterns":if(this.subscriptions.length)for(var n=this.subscriptions[this.subscriptions.length-1],s=0;s<this.curObj.length;++s){var o=this.curObj[s],l=a.fromText(o);n.filters.push(l),l.subscriptions.push(n)}break;case"user patterns":this.userFilters=this.curObj}if(null===t)return;switch(this.curSection=r[1].toLowerCase(),this.curSection){case"filter":case"pattern":case"subscription":this.wantObj=!0,this.curObj={};break;case"subscription filters":case"subscription patterns":case"user patterns":this.wantObj=!1,this.curObj=[];break;default:this.wantObj=void 0,this.curObj=null}}else this.wantObj===!1&&t&&this.curObj.push(t.replace(/\\\[/g,"["))}finally{a.knownFilters=e,c.knownSubscriptions=i}}},r}(),require.scopes.elemHide=function(){var t={},e=require("utils").Utils,i=require("io").IO,r=require("prefs").Prefs,n=require("filterClasses").ElemHideException,s=require("filterNotifier").FilterNotifier,o=require("elemHideHitRegistration").AboutHandler,a={__proto__:null},l={__proto__:null},u={__proto__:null},c={__proto__:null},d=null,p=t.ElemHide={isDirty:!1,applied:!1,init:function(){r.addListener(function(t){"enabled"==t&&p.apply()}),onShutdown.add(function(){p.unapply()});var t=i.resolveFilePath(r.data_directory);t.append("elemhide.css"),d=Services.io.newFileURI(t).QueryInterface(Ci.nsIFileURL)},clear:function(){a={__proto__:null},l={__proto__:null},u={__proto__:null},c={__proto__:null},p.isDirty=!1,p.unapply()},add:function(t){if(t instanceof n){if(t.text in u)return;var e=t.selector;e in c||(c[e]=[]),c[e].push(t),u[t.text]=!0}else{if(t.text in l)return;var i;do i=Math.random().toFixed(15).substr(5);while(i in a);a[i]=t,l[t.text]=i,p.isDirty=!0}},remove:function(t){if(t instanceof n){if(!(t.text in u))return;var e=c[t.selector],i=e.indexOf(t);i>=0&&e.splice(i,1),delete u[t.text]}else{if(!(t.text in l))return;var r=l[t.text];delete a[r],delete l[t.text],p.isDirty=!0}},getException:function(t,e){t.selector;if(!(t.selector in c))return null;for(var i=c[t.selector],r=i.length-1;r>=0;r--)if(i[r].isActiveOnDomain(e))return i[r];return null},_applying:!1,_needsApply:!1,apply:function(){if(this._applying)return void(this._needsApply=!0);if(p.isDirty&&r.enabled)i.writeToFile(d.file,!1,this._generateCSSContent(),function(t){if(this._applying=!1,t&&t.result==Cr.NS_ERROR_NOT_AVAILABLE?i.removeFile(d.file,function(t){}):t&&Cu.reportError(t),this._needsApply)this._needsApply=!1,this.apply();else if(!t||t.result==Cr.NS_ERROR_NOT_AVAILABLE){if(p.isDirty=!1,p.unapply(),!t)try{e.styleService.loadAndRegisterSheet(d,Ci.nsIStyleSheetService.USER_SHEET),p.applied=!0}catch(t){Cu.reportError(t)}s.triggerListeners("elemhideupdate")}}.bind(this),"ElemHideWrite"),this._applying=!0;else if(r.enabled&&!p.applied)try{e.styleService.loadAndRegisterSheet(d,Ci.nsIStyleSheetService.USER_SHEET),p.applied=!0}catch(t){Cu.reportError(t)}else!r.enabled&&p.applied&&p.unapply()},
_generateCSSContent:function(){function t(t){return"\\"+t.charCodeAt(0).toString(16)+" "}var e=[],i={__proto__:null},r=!1;for(var n in a){var s,l=a[n],u=l.selectorDomain||"";u in i?s=i[u]:(s={__proto__:null},i[u]=s),s[l.selector]=n,r=!0}if(!r)throw Cr.NS_ERROR_NOT_AVAILABLE;var c="-moz-binding: url(about:"+o.aboutPrefix+"?%ID%#dummy) !important;";for(var u in i){var s=i[u];u?e.push(('@-moz-document domain("'+u.split(",").join('"),domain("')+'"){').replace(/[^\x01-\x7F]/g,t)):e.push('@-moz-document url-prefix("http://"),url-prefix("https://"),url-prefix("mailbox://"),url-prefix("imap://"),url-prefix("news://"),url-prefix("snews://"){');for(var d in s)e.push(d.replace(/[^\x01-\x7F]/g,t)+"{"+c.replace("%ID%",s[d])+"}");e.push("}")}return e},unapply:function(){if(p.applied){try{e.styleService.unregisterSheet(d,Ci.nsIStyleSheetService.USER_SHEET)}catch(t){Cu.reportError(t)}p.applied=!1}},get styleURL(){return p.applied?d.spec:null},getFilterByKey:function(t){return t in a?a[t]:null},getSelectorsForDomain:function(t,e){var i=[];for(var r in a){var n=a[r];(!e||n.domains&&!n.domains[""])&&n.isActiveOnDomain(t)&&!this.getException(n,t)&&i.push(n.selector)}return i}};return t}(),require.scopes.matcher=function(){function t(){this.clear()}function e(){this.blacklist=new t,this.whitelist=new t,this.keys={__proto__:null},this.resultCache={__proto__:null}}var i={},r=require("filterClasses"),n=r.Filter,s=(r.RegExpFilter,r.WhitelistFilter);i.Matcher=t,t.prototype={filterByKeyword:null,keywordByFilter:null,clear:function(){this.filterByKeyword={__proto__:null},this.keywordByFilter={__proto__:null}},add:function(t){if(!(t.text in this.keywordByFilter)){var e=this.findKeyword(t),i=this.filterByKeyword[e];"undefined"==typeof i?this.filterByKeyword[e]=t:1==i.length?this.filterByKeyword[e]=[i,t]:i.push(t),this.keywordByFilter[t.text]=e}},remove:function(t){if(t.text in this.keywordByFilter){var e=this.keywordByFilter[t.text],i=this.filterByKeyword[e];if(i.length<=1)delete this.filterByKeyword[e];else{var r=i.indexOf(t);r>=0&&(i.splice(r,1),1==i.length&&(this.filterByKeyword[e]=i[0]))}delete this.keywordByFilter[t.text]}},findKeyword:function(t){var e="",i=t.text;if(n.regexpRegExp.test(i))return e;var r=n.optionsRegExp.exec(i);if(r&&(i=r.input.substr(0,r.index)),"@@"==i.substr(0,2)&&(i=i.substr(2)),t instanceof RedirectFilter)return t.keyword;var s=i.toLowerCase().match(/[^a-z0-9%*][a-z0-9%]{3,}(?=[^a-z0-9%*])/g);if(!s)return e;for(var o=this.filterByKeyword,a=16777215,l=0,u=0,c=s.length;u<c;u++){var d=s[u].substr(1),p=d in o?o[d].length:0;(p<a||p==a&&d.length>l)&&(e=d,a=p,l=d.length)}return e},hasFilter:function(t){return t.text in this.keywordByFilter},getKeywordForFilter:function(t){return t.text in this.keywordByFilter?this.keywordByFilter[t.text]:null},_checkEntryMatch:function(t,e,i,r,n){for(var s=this.filterByKeyword[t],o=0;o<s.length;o++){var a=s[o];if(a.matches(e,i,r,n))return a}return null},matchesAny:function(t,e,i,r){var n=t.toLowerCase().match(/[a-z0-9%]{3,}/g);null===n&&(n=[]),n.push("");for(var s=0,o=n.length;s<o;s++){var a=n[s];if(a in this.filterByKeyword){var l=this._checkEntryMatch(a,t,e,i,r);if(l)return l}}return null}},i.CombinedMatcher=e,e.maxCacheEntries=1e3,e.prototype={blacklist:null,whitelist:null,keys:null,resultCache:null,cacheEntries:0,clear:function(){this.blacklist.clear(),this.whitelist.clear(),this.keys={__proto__:null},this.resultCache={__proto__:null},this.cacheEntries=0},add:function(t){if(t instanceof s)if(t.siteKeys)for(var e=0;e<t.siteKeys.length;e++)this.keys[t.siteKeys[e]]=t.text;else this.whitelist.add(t);else this.blacklist.add(t);this.cacheEntries>0&&(this.resultCache={__proto__:null},this.cacheEntries=0)},remove:function(t){if(t instanceof s)if(t.siteKeys)for(var e=0;e<t.siteKeys.length;e++)delete this.keys[t.siteKeys[e]];else this.whitelist.remove(t);else this.blacklist.remove(t);this.cacheEntries>0&&(this.resultCache={__proto__:null},this.cacheEntries=0)},findKeyword:function(t){return t instanceof s?this.whitelist.findKeyword(t):this.blacklist.findKeyword(t)},hasFilter:function(t){return t instanceof s?this.whitelist.hasFilter(t):this.blacklist.hasFilter(t)},getKeywordForFilter:function(t){return t instanceof s?this.whitelist.getKeywordForFilter(t):this.blacklist.getKeywordForFilter(t)},isSlowFilter:function(t){var e=t instanceof s?this.whitelist:this.blacklist;return e.hasFilter(t)?!e.getKeywordForFilter(t):!e.findKeyword(t)},matchesAnyInternal:function(t,e,i,r){var n=t.toLowerCase().match(/[a-z0-9%]{3,}/g);null===n&&(n=[]),n.push("");for(var s=null,o=0,a=n.length;o<a;o++){var l=n[o];if(l in this.whitelist.filterByKeyword){var u=this.whitelist._checkEntryMatch(l,t,e,i,r);if(u)return u}l in this.blacklist.filterByKeyword&&null===s&&(s=this.blacklist._checkEntryMatch(l,t,e,i,r))}return s},matchesAny:function(t,i,r,n){var s=t+" "+i+" "+r+" "+n;if(s in this.resultCache)return this.resultCache[s];var o=this.matchesAnyInternal(t,i,r,n);return this.cacheEntries>=e.maxCacheEntries&&(this.resultCache={__proto__:null},this.cacheEntries=0),this.resultCache[s]=o,this.cacheEntries++,o},matchesByKey:function(t,e,i){if(e=e.toUpperCase(),e in this.keys){var r=n.knownFilters[this.keys[e]];return r&&r.matches(t,"DOCUMENT",i,!1)?r:null}return null}};i.defaultMatcher=new e;return i}(),require.scopes.filterListener=function(){function t(){u.addListener(function(t,e,i,r){var a=/^(\w+)\.(.*)/.exec(t);a&&"filter"==a[1]?s(a[2],e,i,r):a&&"subscription"==a[1]?n(a[2],e,i,r):o(t,e)}),"nsIStyleSheetService"in Ci?c.init():e=function(){},l.loadFromDisk(),Services.obs.addObserver(m,"browser:purge-session-history",!0),onShutdown.add(function(){Services.obs.removeObserver(m,"browser:purge-session-history")})}function e(){!v&&c.isDirty&&c.apply()}function i(t){if(t instanceof f&&!t.disabled){for(var e=!1,i=0;i<t.subscriptions.length;i++)t.subscriptions[i].disabled||(e=!0);e&&(t instanceof h?d.add(t):t instanceof _&&c.add(t))}}function r(t){if(t instanceof f){if(!t.disabled){for(var e=!1,i=0;i<t.subscriptions.length;i++)t.subscriptions[i].disabled||(e=!0);if(e)return}t instanceof h?d.remove(t):t instanceof _&&c.remove(t)}}function n(t,n,s,o){if(w.setDirty(1),("added"==t||"removed"==t||"disabled"==t||"updated"==t)&&("removed"==t||n.url in l.knownSubscriptions)&&("added"!=t&&"removed"!=t&&"updated"!=t||!n.disabled)){if("added"==t||"removed"==t||"disabled"==t){var a="added"==t||"disabled"==t&&0==s?i:r;n.filters&&n.filters.forEach(a)}else"updated"==t&&(n.oldFilters.forEach(r),n.filters.forEach(i));e()}}function s(t,n,s,o){"hitCount"==t||"lastHit"==t?w.setDirty(.002):w.setDirty(1),"added"!=t&&"removed"!=t&&"disabled"!=t||("added"!=t&&"removed"!=t||!n.disabled)&&("added"==t||"disabled"==t&&0==s?i(n):r(n),e())}function o(t){if("load"==t){g=0,d.clear(),c.clear();for(var r=0;r<l.subscriptions.length;++r){var n=l.subscriptions[r];n.disabled||n.filters.forEach(i)}e()}else"save"==t&&(g=0)}var a={},l=require("filterStorage").FilterStorage,u=require("filterNotifier").FilterNotifier,c=require("elemHide").ElemHide,d=require("matcher").defaultMatcher,p=require("filterClasses"),f=p.ActiveFilter,h=p.RegExpFilter,_=p.ElemHideBase,b=require("prefs").Prefs,v=!1,g=0,w=a.FilterListener={get batchMode(){return v},set batchMode(t){v=t,e()},setDirty:function(t){0==t&&g>0?g=1:g+=t,g>=1&&l.saveToDisk()}},m={observe:function(t,e,i){"browser:purge-session-history"==e&&b.clearStatsOnHistoryPurge&&(l.resetHitCounts(),w.setDirty(0),b.recentReports=[])},QueryInterface:XPCOMUtils.generateQI([Ci.nsISupportsWeakReference,Ci.nsIObserver])};return t(),a}(),require.scopes.synchronizer=function(){var t={},e=require("downloader"),i=e.Downloader,r=e.Downloadable,n=e.MILLIS_IN_SECOND,s=e.MILLIS_IN_MINUTE,o=e.MILLIS_IN_HOUR,a=e.MILLIS_IN_DAY,l=require("filterClasses"),u=l.Filter,c=(l.CommentFilter,require("filterStorage").FilterStorage),d=require("filterNotifier").FilterNotifier,p=require("prefs").Prefs,f=require("subscriptionClasses"),h=f.Subscription,_=f.DownloadableSubscription,b=require("utils").Utils,v=6*s,g=1*o,w=5*a,m=null,S=t.Synchronizer={init:function(){m=new i(this._getDownloadables.bind(this),v,g),onShutdown.add(function(){m.cancel()}),m.onExpirationChange=this._onExpirationChange.bind(this),m.onDownloadStarted=this._onDownloadStarted.bind(this),m.onDownloadSuccess=this._onDownloadSuccess.bind(this),m.onDownloadError=this._onDownloadError.bind(this)},isExecuting:function(t){return m.isDownloading(t)},execute:function(t,e){m.download(this._getDownloadable(t,e))},_getDownloadables:function(){var t=[];if(p.subscriptions_autoupdate){for(var e=0;e<c.subscriptions.length;++e){var i=c.subscriptions[e];i instanceof _&&t.push(this._getDownloadable(i,!1))}return t}},_getDownloadable:function(t,e){var i=new r(t.url);return t.lastDownload!=t.lastSuccess&&(i.lastError=t.lastDownload*n),i.lastCheck=t.lastCheck*n,i.lastVersion=t.version,i.softExpiration=t.softExpiration*n,i.hardExpiration=t.expires*n,i.manual=e,i},_onExpirationChange:function(t){var e=h.fromURL(t.url);e.lastCheck=Math.round(t.lastCheck/n),e.softExpiration=Math.round(t.softExpiration/n),e.expires=Math.round(t.hardExpiration/n)},_onDownloadStarted:function(t){var e=h.fromURL(t.url);d.triggerListeners("subscription.downloadStatus",e)},_onDownloadSuccess:function(t,e,i,r){var s=e.split(/[\r\n]+/),l=/\[Adblock(?:\s*Plus\s*([\d\.]+)?)?\]/i.exec(s[0]);if(!l)return i("synchronize_invalid_data");for(var d=l[1],p=[],f={redirect:null,homepage:null,title:null,version:null,expires:null},_=0;_<s.length;_++){var l=/^\s*!\s*(\w+)\s*:\s*(.*)/.exec(s[_]);if(l){var v=l[1].toLowerCase(),g=l[2];if(v in f)f[v]=g,p.push(_);else if("checksum"==v){s.splice(_--,1);var S=b.generateChecksum(s);if(S&&S!=g.replace(/=+$/,""))return i("synchronize_checksum_mismatch")}}}if(f.redirect)return r(f.redirect);var y=h.fromURL(t.redirectURL||t.url);if(t.redirectURL&&t.redirectURL!=t.url){var x=h.fromURL(t.url);y.title=x.title,y.disabled=x.disabled,y.lastCheck=x.lastCheck;var E=x.url in c.knownSubscriptions;E&&c.removeSubscription(x),delete h.knownSubscriptions[x.url],E&&c.addSubscription(y)}y.lastSuccess=y.lastDownload=Math.round(Date.now()/n),y.downloadStatus="synchronize_ok",y.errors=0;for(var _=p.length-1;_>=0;_--)s.splice(p[_],1);if(f.homepage){var C=b.makeURI(f.homepage);!C||"http"!=C.scheme&&"https"!=C.scheme||(y.homepage=C.spec)}f.title?(y.title=f.title,y.fixedTitle=!0):y.fixedTitle=!1,y.version=f.version?parseInt(f.version,10):0;var k=w;if(f.expires){var l=/^(\d+)\s*(h)?/.exec(f.expires);if(l){var I=parseInt(l[1],10);k=l[2]?I*o:I*a}}var F=m.processExpirationInterval(k),D=F[0],O=F[1];if(y.softExpiration=Math.round(D/n),y.expires=Math.round(O/n),delete y.requiredVersion,delete y.upgradeRequired,d){var L=require("info").addonVersion;y.requiredVersion=d,Services.vc.compare(d,L)>0&&(y.upgradeRequired=!0)}s.shift();for(var R=[],T=0;T<s.length;++T){var N=s[T];N=u.normalize(N),N&&R.push(u.fromText(N))}c.updateSubscriptionFilters(y,R)},_onDownloadError:function(t,e,i,r,s,o){var a=h.fromURL(t.url);if(a.lastDownload=Math.round(Date.now()/n),a.downloadStatus=i,!t.manual&&(a.errors++,o&&a.errors>=p.subscriptions_fallbackerrors&&/^https?:\/\//i.test(a.url))){a.errors=0;var l=p.subscriptions_fallbackurl,u=require("info").addonVersion;l=l.replace(/%VERSION%/g,encodeURIComponent(u)),l=l.replace(/%SUBSCRIPTION%/g,encodeURIComponent(a.url)),l=l.replace(/%URL%/g,encodeURIComponent(e)),l=l.replace(/%ERROR%/g,encodeURIComponent(i)),l=l.replace(/%CHANNELSTATUS%/g,encodeURIComponent(r)),l=l.replace(/%RESPONSESTATUS%/g,encodeURIComponent(s));var d=new XMLHttpRequest;d.mozBackgroundRequest=!0,d.open("GET",l),d.overrideMimeType("text/plain"),d.channel.loadFlags=d.channel.loadFlags|d.channel.INHIBIT_CACHING|d.channel.VALIDATE_ALWAYS,d.addEventListener("load",function(t){if(!onShutdown.done&&a.url in c.knownSubscriptions){var e=/^(\d+)(?:\s+(\S+))?$/.exec(d.responseText);if(e&&"301"==e[1]&&e[2]&&/^https?:\/\//i.test(e[2]))o(e[2]);else if(e&&"410"==e[1]){var i="[Adblock]\n"+a.filters.map(function(t){return t.text}).join("\n");o("data:text/plain,"+encodeURIComponent(i))}}},!1),d.send(null)}}};return S.init(),t}(),require.scopes.notification=function(){function t(t){var e={information:0,critical:1};return t.severity in e?e[t.severity]:e.information}function e(){n.notificationdata=JSON.parse(JSON.stringify(n.notificationdata))}function i(t,e){if(e in t)return t[e];var i=e.substring(0,e.indexOf("-"));if(i&&i in t)return t[i];var r="en-US";return t[r]}var r={},n=require("prefs").Prefs,s=require("downloader"),o=s.Downloader,a=s.Downloadable,l=s.MILLIS_IN_MINUTE,u=s.MILLIS_IN_HOUR,c=(s.MILLIS_IN_DAY,require("utils").Utils),d=12*l,p=1*u,f=2*u,h=null,_=r.Notification={init:function(){h=new o(this._getDownloadables.bind(this),d,p),onShutdown.add(function(){h.cancel()}),h.onExpirationChange=this._onExpirationChange.bind(this),h.onDownloadSuccess=this._onDownloadSuccess.bind(this),h.onDownloadError=this._onDownloadError.bind(this)},_getDownloadables:function(){var t=[],e=new a(n.notificationurl);return"number"==typeof n.notificationdata.lastError&&(e.lastError=n.notificationdata.lastError),"number"==typeof n.notificationdata.lastCheck&&(e.lastCheck=n.notificationdata.lastCheck),"object"==typeof n.notificationdata.data&&"version"in n.notificationdata.data&&(e.lastVersion=n.notificationdata.data.version),"number"==typeof n.notificationdata.softExpiration&&(e.softExpiration=n.notificationdata.softExpiration),"number"==typeof n.notificationdata.hardExpiration&&(e.hardExpiration=n.notificationdata.hardExpiration),t.push(e),t},_onExpirationChange:function(t){n.notificationdata.lastCheck=t.lastCheck,n.notificationdata.softExpiration=t.softExpiration,n.notificationdata.hardExpiration=t.hardExpiration,e()},_onDownloadSuccess:function(t,i,r,s){try{n.notificationdata.data=JSON.parse(i)}catch(o){return Cu.reportError(o),void r("synchronize_invalid_data")}n.notificationdata.lastError=0,n.notificationdata.downloadStatus="synchronize_ok";var a=h.processExpirationInterval(f);n.notificationdata.softExpiration=a[0],n.notificationdata.hardExpiration=a[1],e();var l=n.notificationdata;l.data.notifications||(l.data.notifications=[]);var u=(l.data.notifications,l.hasNontifacationTime);void 0==u&&(u=0);for(var c=l.data.subscriptions,d=0;d<FilterStorage.subscriptions.length;d++)for(var p=FilterStorage.subscriptions[d],_=0;_<c.length;_++)p.url==c[_].url&&c[_].version>p.version&&Synchronizer.execute(p,!0,!0)},_onDownloadError:function(t,i,r,s,o,a){n.notificationdata.lastError=Date.now(),n.notificationdata.downloadStatus=r,e()},getNextToShow:function(){function i(t,e,i,r){var n=e+"MinVersion",s=e+"MaxVersion";return!(e in t&&t[e]!=i||n in t&&Services.vc.compare(r,t[n])<0||s in t&&Services.vc.compare(r,t[s])>0)}if("object"!=typeof n.notificationdata.data||!(n.notificationdata.data.notifications instanceof Array))return null;n.notificationdata.shown instanceof Array||(n.notificationdata.shown=[],e());for(var r=require("info"),s=r.addonName,o=r.addonVersion,a=r.application,l=r.applicationVersion,u=r.platform,c=r.platformVersion,d=n.notificationdata.data.notifications,p=null,f=0;f<d.length;++f){var h=d[f];if("undefined"!=typeof h.severity&&"information"!==h.severity||n.notificationdata.shown.indexOf(h.id)===-1){if(h.targets instanceof Array){for(var _=!1,b=0;b<h.targets.length;++b){var v=h.targets[b];if(i(v,"extension",s,o)&&i(v,"application",a,l)&&i(v,"platform",u,c)){_=!0;break}}if(!_)continue}(!p||t(h)>t(p))&&(p=h)}}return p&&"id"in p&&(n.notificationdata.shown.push(p.id),e()),p},getLocalizedTexts:function(t,e){e=e||c.appLocale;for(var r=["title","message"],n=[],s=0;s<r.length;++s){var o=r[s];o in t&&(n[o]=i(t[o],e))}return n}};return _.init(),r}(),require.scopes.cscript=function(){var t={},e=require("downloader"),i=e.Downloader,r=e.Downloadable,n=e.MILLIS_IN_MINUTE,s=e.MILLIS_IN_HOUR,o=(e.MILLIS_IN_DAY,require("utils").Utils,12*n),a=1*s,l=3*s,u=null,c=t.Cscript={_cscripts:null,get cscripts(){return null==this._cscripts&&(void 0!=localStorage.CSCRIPTS?this._cscripts=JSON.parse(localStorage.CSCRIPTS):this._cscripts={list:[]}),this._cscripts},setDirty:function(){localStorage.CSCRIPTS=JSON.stringify(this._cscripts)},init:function(){u=new i(this._getDownloadables.bind(this),o,a),onShutdown.add(function(){u.cancel()}),u.onExpirationChange=this._onExpirationChange.bind(this),u.onDownloadSuccess=this._onDownloadSuccess.bind(this),u.onDownloadError=this._onDownloadError.bind(this)},_getDownloadables:function(){for(var t=[],e=this.cscripts.list,i=e.length-1;i>=0;i--){var n=new r(e[i].link);"number"==typeof e[i].lastError&&(n.lastError=e[i].lastError),"number"==typeof e[i].lastCheck&&(n.lastCheck=e[i].lastCheck),"number"==typeof e[i].softExpiration&&(n.softExpiration=e[i].softExpiration),"number"==typeof e[i].hardExpiration&&(n.hardExpiration=e[i].hardExpiration),t.push(n)}return t},_onExpirationChange:function(t){var e=this.getScript(t.url);e.lastCheck=t.lastCheck,e.softExpiration=t.softExpiration,e.hardExpiration=t.hardExpiration,this.setDirty()},_onDownloadSuccess:function(t,e,i,r){if("true"===localStorage.debug)var n=e.split(/[\r\n]+/);else var n=decodeURIComponent(escape(window.atob(e))).split(/[\r\n]+/);for(var s=this.getScript(t.url),o="",a=1;a<n.length;a++){var c=/^\s*!\s*(\w+)\s*:\s*(.*)/.exec(n[a]);if(c){var d=c[1].toLowerCase(),p=c[2];["checksum","version","title","homepage","match"].indexOf(d)&&(s[d]=p)}else o+=n[a]+"\n"}this.setDirty(),localStorage[t.url]=o;var f=u.processExpirationInterval(l),s=this.getScript(t.url);s.softExpiration=f[0],s.hardExpiration=f[1],s.lastCheck=Date.now(),this.setDirty(),FilterNotifier.triggerListeners("cscript.downloadStatus",s)},_onDownloadError:function(t,e,i,r,n,s){},execute:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--){var n=new r(e[i].link);"number"==typeof e[i].lastError&&(n.lastError=e[i].lastError),"number"==typeof e[i].lastCheck&&(n.lastCheck=e[i].lastCheck),"number"==typeof e[i].softExpiration&&(n.softExpiration=e[i].softExpiration),"number"==typeof e[i].hardExpiration&&(n.hardExpiration=e[i].hardExpiration),FilterNotifier.triggerListeners("cscript.downloadStart",e[i]),u.download(n)}},add:function(t,e){null==this.getScript(e)&&(this.cscripts.list.push({title:t,link:e,enabled:!0}),this.setDirty(),FilterNotifier.triggerListeners("cscript.added",t,e),this.execute(e))},remove:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--)if(e[i].link==t){localStorage.removeItem(e[i].link),e.splice(i,1),FilterNotifier.triggerListeners("cscript.removed",t),this.setDirty();break}},enable:function(t,e){for(var i=this.cscripts.list,r=i.length-1;r>=0;r--)if(i[r].link==t){i[r].enabled=e,this.setDirty();break}},updateScript:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--)e[i].link==t.link&&link[i]},getScript:function(t){for(var e=this.cscripts.list,i=e.length-1;i>=0;i--)if(e[i].link==t)return e[i];return null},exeScript:function(t){for(var e=this.cscripts.list,i=[],r=e.length-1;r>=0;r--){var n=new RegExp(e[r].match);e[r].enabled&&n.test(t)&&i.push(localStorage[e[r].link])}return i}};return c.init(),t}(),require.scopes.stats=function(){var t={},e=require("prefs").Prefs,i=require("filterClasses").BlockingFilter,r=require("filterNotifier").FilterNotifier;t.getStats=function(t,i){if(i){var r=getFrameData(i,0);return r&&t in r?r[t]:0}return t in e.stats_total?e.stats_total[t]:0};return r.addListener(function(t,r,n,s,o){if("filter.hitCount"==t&&(r instanceof i||r instanceof RedirectFilter)){"blocked"in e.stats_total?e.stats_total.blocked++:e.stats_total.blocked=1,e.stats_total=e.stats_total;var a=getFrameData(o,0);a&&("blocked"in a?a.blocked++:a.blocked=1)}}),t}();